<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Modern Doors & Windows Budget Calculator</title>

    <!-- Chart.js for visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- jsPDF for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://www.google.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Custom Styles -->
    <style>
      :root {
        --brand-color: #8b5cf6; /* Purple */
        --brand-color-hover: #7c3aed;
        --brand-color-light: #f5f3ff;
        --success-color: #16a34a;
        --success-color-hover: #15803d;
        --text-primary: #111827;
        --text-secondary: #374151;
        --text-light: #6b7280;
        --bg-body: #f8fafc;
        --bg-card: #ffffff;
        --border-color: #d1d5db;
        --border-radius-lg: 0.75rem;
      }

      body {
        font-family: "Inter", sans-serif;
        background-color: var(--bg-body);
        color: var(--text-secondary);
        margin: 0;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      .container {
        max-width: 64rem; /* Wider for visualizer */
        margin: 0 auto;
        padding: 1rem;
      }

      header {
        text-align: center;
        margin-bottom: 2rem;
      }
      header h1 {
        font-size: 1.875rem;
        font-weight: 700;
        color: var(--text-primary);
        margin: 0;
      }

      main {
        background-color: var(--bg-card);
        padding: 1.5rem;
        border-radius: 1.5rem;
        box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1),
          0 4px 6px -4px rgb(0 0 0 / 0.1);
      }

      .step-navigation {
        display: flex;
        border-bottom: 1px solid var(--border-color);
        margin-bottom: 2rem;
      }
      .step-btn {
        flex: 1;
        padding: 0.75rem 0;
        text-align: center;
        font-weight: 600;
        border: none;
        border-bottom: 2px solid transparent;
        background: none;
        cursor: default;
        color: var(--text-light);
      }
      .step-btn.active {
        color: var(--brand-color);
        border-bottom-color: var(--brand-color);
      }

      .step {
        display: none;
      }
      .step.active {
        display: block;
      }

      h2 {
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 1.5rem;
      }
      label {
        display: block;
        font-size: 0.875rem;
        font-weight: 500;
        color: var(--text-secondary);
        margin-bottom: 0.25rem;
      }

      input[type="number"],
      input[type="text"],
      select {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius-lg);
        box-sizing: border-box;
        transition: box-shadow 0.2s, border-color 0.2s;
      }
      input:focus {
        outline: none;
        border-color: var(--brand-color);
        box-shadow: 0 0 0 2px var(--brand-color-light);
      }

      .btn {
        border: none;
        font-weight: 600;
        padding: 0.75rem 1.5rem;
        border-radius: var(--border-radius-lg);
        cursor: pointer;
        transition: background-color 0.2s;
      }
      .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      .btn-primary {
        background-color: var(--brand-color);
        color: white;
      }
      .btn-primary:hover {
        background-color: var(--brand-color-hover);
      }
      .btn-secondary {
        background-color: #e5e7eb;
        color: var(--text-secondary);
      }
      .btn-secondary:hover {
        background-color: #d1d5db;
      }
      .btn-submit {
        background-color: var(--success-color);
        color: white;
        font-weight: 700;
      }
      .btn-submit:hover {
        background-color: var(--success-color-hover);
      }

      .form-navigation {
        margin-top: 2.5rem;
        display: flex;
        justify-content: space-between;
      }
      .hidden {
        display: none;
      }

      /* Step 1 Specific */
      .openings-layout {
        display: grid;
        grid-template-columns: 1fr;
        gap: 2rem;
      }
      .add-opening-controls {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 1rem;
        align-items: end;
        border-top: 1px solid var(--border-color);
        padding-top: 1.5rem;
        margin-top: 1.5rem;
      }
      .opening-card {
        background-color: #f9fafb;
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius-lg);
        padding: 1rem;
        margin-top: 1rem;
      }
      .opening-card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .remove-opening-btn {
        background: none;
        border: none;
        color: #ef4444;
        font-weight: 600;
        cursor: pointer;
      }
      .opening-card-body {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1rem;
        margin-top: 1rem;
      }

      .visualizer-container {
        background-color: var(--brand-color-light);
        border-radius: var(--border-radius-lg);
        padding: 1rem;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 300px;
      }
      #visualizerCanvas {
        max-width: 100%;
        height: auto;
      }

      /* Step 2 Specific */
      .quality-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
      }
      .quality-option {
        padding: 1rem;
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius-lg);
        cursor: pointer;
        text-align: center;
      }
      .quality-option h3 {
        margin: 0 0 0.5rem 0;
      }
      .quality-option p {
        font-size: 0.875rem;
        color: var(--text-light);
        margin: 0;
      }
      .quality-option:has(input:checked) {
        background-color: var(--brand-color-light);
        border-color: var(--brand-color);
      }
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border-width: 0;
      }

      /* Results Section */
      #results {
        margin-top: 2.5rem;
      }
      .results-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
        margin-bottom: 1.5rem;
      }
      .results-card {
        background-color: var(--bg-card);
        padding: 2rem;
        border-radius: 1.5rem;
        box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1),
          0 4px 6px -4px rgb(0 0 0 / 0.1);
      }
      .results-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 2rem;
        align-items: center;
      }
      .chart-container {
        max-width: 24rem;
        width: 100%;
        margin: 0 auto;
      }
      #grandTotal {
        font-size: 3rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 1.5rem;
      }
      .summary-item {
        display: flex;
        justify-content: space-between;
        font-size: 1.125rem;
      }
      .summary-item + .summary-item {
        margin-top: 0.75rem;
      }
      .summary-item span:first-child {
        color: var(--text-light);
      }
      .summary-item span:last-child {
        font-weight: 600;
        color: var(--text-secondary);
      }
      .detailed-breakdown-container {
        margin-top: 2rem;
        border-top: 1px solid var(--border-color);
        padding-top: 1.5rem;
      }

      @media (min-width: 768px) {
        .openings-layout {
          grid-template-columns: 1fr 1fr;
        }
        .results-grid {
          grid-template-columns: repeat(2, 1fr);
        }
      }
      @media (min-width: 1024px) {
        main,
        .results-card {
          padding: 2rem;
        }
        h1 {
          font-size: 2.25rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header><h1>Doors & Windows Budget Calculator</h1></header>

      <main>
        <div class="step-navigation">
          <button id="step-btn-1" class="step-btn active">
            1. Openings & Dimensions
          </button>
          <button id="step-btn-2" class="step-btn">
            2. Materials & Quality
          </button>
          <button id="step-btn-3" class="step-btn">3. Labor Rates</button>
        </div>

        <form id="dwForm">
          <!-- Step 1: Openings Details -->
          <div id="step-1" class="step active">
            <h2>Define Openings & Visualize</h2>
            <div class="openings-layout">
              <div>
                <p>
                  Add each door and window and provide its dimensions in feet.
                </p>
                <div id="openings-container"></div>
                <div class="add-opening-controls">
                  <div>
                    <label for="openingName">Opening Name</label
                    ><input
                      type="text"
                      id="openingName"
                      placeholder="e.g., Main Door"
                    />
                  </div>
                  <button
                    type="button"
                    id="addOpeningBtn"
                    class="btn btn-primary"
                  >
                    Add Opening
                  </button>
                </div>
              </div>
              <div class="visualizer-container">
                <canvas id="visualizerCanvas" width="300" height="300"></canvas>
              </div>
            </div>
          </div>

          <!-- Step 2: Material Quality -->
          <div id="step-2" class="step">
            <h2>Frame & Shutter Materials</h2>
            <p>
              Select the material type. Costs are indicative per square foot.
            </p>
            <div class="quality-grid">
              <label class="quality-option">
                <input
                  type="radio"
                  name="materialQuality"
                  value="teak"
                  class="sr-only"
                  checked
                />
                <h3>Teak Wood</h3>
                <p>₹1800 - ₹2500 / sq.ft.</p>
              </label>
              <label class="quality-option">
                <input
                  type="radio"
                  name="materialQuality"
                  value="wood"
                  class="sr-only"
                />
                <h3>Other Hard Wood</h3>
                <p>₹1200 - ₹1800 / sq.ft.</p>
              </label>
              <label class="quality-option">
                <input
                  type="radio"
                  name="materialQuality"
                  value="upvc"
                  class="sr-only"
                />
                <h3>UPVC</h3>
                <p>₹600 - ₹1200 / sq.ft.</p>
              </label>
              <label class="quality-option">
                <input
                  type="radio"
                  name="materialQuality"
                  value="aluminium"
                  class="sr-only"
                />
                <h3>Aluminium</h3>
                <p>₹500 - ₹900 / sq.ft.</p>
              </label>
            </div>
          </div>

          <!-- Step 3: Labor Cost -->
          <div id="step-3" class="step">
            <h2>Labor & Installation Costs</h2>
            <p>Enter local labor rates for installation and frame fitting.</p>
            <div
              style="
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 1.5rem;
              "
            >
              <div>
                <label for="installationLabor"
                  >Installation Labor (₹ per sq.ft.)</label
                >
                <input type="number" id="installationLabor" value="150" />
              </div>
              <div>
                <label for="frameLabor"
                  >Granite Frame Labor (₹ per running ft.)</label
                >
                <input
                  type="number"
                  id="frameLabor"
                  value="120"
                  placeholder="0 if not applicable"
                />
              </div>
            </div>
          </div>

          <div class="form-navigation">
            <button
              type="button"
              id="prevBtn"
              class="btn btn-secondary"
              disabled
            >
              Previous
            </button>
            <button type="button" id="nextBtn" class="btn btn-primary">
              Next
            </button>
            <button type="submit" id="submitBtn" class="btn btn-submit hidden">
              Calculate Budget
            </button>
          </div>
        </form>
      </main>

      <section id="results" class="hidden">
        <header class="results-header">
          <h2>Your Estimated Budget</h2>
          <button id="downloadPdfBtn" class="btn btn-primary">
            Download PDF
          </button>
        </header>
        <div class="results-card">
          <div class="results-grid">
            <div class="chart-container"><canvas id="costChart"></canvas></div>
            <div>
              <p>Total Estimated Cost</p>
              <p id="grandTotal">₹0</p>
              <div class="summary-details">
                <div class="summary-item">
                  <span>Total Material Cost:</span
                  ><span id="totalMaterialCost">₹0</span>
                </div>
                <div class="summary-item">
                  <span>Total Labor Cost:</span
                  ><span id="totalLaborCost">₹0</span>
                </div>
              </div>
            </div>
          </div>
          <div class="detailed-breakdown-container">
            <h3>Detailed Breakdown</h3>
            <div id="detailed-breakdown"></div>
          </div>
        </div>
      </section>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        let currentStep = 1,
          totalSteps = 3,
          openings = [],
          chartInstance = null,
          lastCalculationData = null;

        const elements = {
          stepButtons: document.querySelectorAll(".step-btn"),
          steps: document.querySelectorAll(".step"),
          prevBtn: document.getElementById("prevBtn"),
          nextBtn: document.getElementById("nextBtn"),
          submitBtn: document.getElementById("submitBtn"),
          addOpeningBtn: document.getElementById("addOpeningBtn"),
          openingsContainer: document.getElementById("openings-container"),
          form: document.getElementById("dwForm"),
          resultsSection: document.getElementById("results"),
          downloadPdfBtn: document.getElementById("downloadPdfBtn"),
          canvas: document.getElementById("visualizerCanvas"),
          ctx: document.getElementById("visualizerCanvas").getContext("2d"),
        };

        const costData = {
          materialPerSqFt: {
            teak: 2200,
            wood: 1500,
            upvc: 900,
            aluminium: 700,
          },
        };

        function updateStepVisibility() {
          elements.steps.forEach((s, i) =>
            s.classList.toggle("active", i + 1 === currentStep)
          );
          elements.stepButtons.forEach((b, i) =>
            b.classList.toggle("active", i < currentStep)
          );
          elements.prevBtn.disabled = currentStep === 1;
          elements.nextBtn.classList.toggle(
            "hidden",
            currentStep === totalSteps
          );
          elements.submitBtn.classList.toggle(
            "hidden",
            currentStep !== totalSteps
          );
        }

        function addOpening() {
          const nameInput = document.getElementById("openingName");
          const name =
            nameInput.value.trim() || `Opening ${openings.length + 1}`;
          const id = `opening-${Date.now()}`;
          openings.push({ id, name, width: 3, height: 7, frameRft: 20 });
          nameInput.value = "";
          renderOpenings();
          drawVisualizer(openings[openings.length - 1]);
        }

        function renderOpenings() {
          elements.openingsContainer.innerHTML = openings
            .map(
              (op) => `
                    <div id="${op.id}" class="opening-card">
                        <div class="opening-card-header">
                            <h3>${op.name}</h3>
                            <button type="button" class="remove-opening-btn" data-id="${op.id}">Remove</button>
                        </div>
                        <div class="opening-card-body">
                            <div><label>Width (ft)</label><input type="number" class="opening-input" data-id="${op.id}" data-prop="width" value="${op.width}" step="0.1"></div>
                            <div><label>Height (ft)</label><input type="number" class="opening-input" data-id="${op.id}" data-prop="height" value="${op.height}" step="0.1"></div>
                            <div><label>Frame (rft)</label><input type="number" class="opening-input" data-id="${op.id}" data-prop="frameRft" value="${op.frameRft}" step="0.1"></div>
                        </div>
                    </div>`
            )
            .join("");
        }

        function updateOpening(id, prop, value) {
          const opening = openings.find((o) => o.id === id);
          if (opening) {
            opening[prop] = parseFloat(value) || 0;
            drawVisualizer(opening);
          }
        }

        function removeOpening(id) {
          openings = openings.filter((o) => o.id !== id);
          renderOpenings();
          elements.ctx.clearRect(
            0,
            0,
            elements.canvas.width,
            elements.canvas.height
          );
          if (openings.length > 0)
            drawVisualizer(openings[openings.length - 1]);
        }

        function drawVisualizer(opening) {
          const { ctx, canvas } = elements;
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          if (!opening) return;

          const PADDING = 20;
          const availableWidth = canvas.width - 2 * PADDING;
          const availableHeight = canvas.height - 2 * PADDING;

          const scale = Math.min(
            availableWidth / opening.width,
            availableHeight / opening.height
          );

          const rectWidth = opening.width * scale;
          const rectHeight = opening.height * scale;
          const x = (canvas.width - rectWidth) / 2;
          const y = (canvas.height - rectHeight) / 2;

          const rootStyles = getComputedStyle(document.documentElement);
          const brandColor = rootStyles
            .getPropertyValue("--brand-color")
            .trim();
          const textColor = rootStyles
            .getPropertyValue("--text-primary")
            .trim();

          ctx.strokeStyle = brandColor;
          ctx.fillStyle = "rgba(139, 92, 246, 0.1)";
          ctx.lineWidth = 2;
          ctx.fillRect(x, y, rectWidth, rectHeight);
          ctx.strokeRect(x, y, rectWidth, rectHeight);

          ctx.fillStyle = textColor;
          ctx.font = "14px Inter";
          ctx.textAlign = "center";
          ctx.fillText(
            `${opening.width} ft`,
            canvas.width / 2,
            y + rectHeight + PADDING - 5
          );

          ctx.save();
          ctx.translate(x - 10, canvas.height / 2);
          ctx.rotate(-Math.PI / 2);
          ctx.fillText(`${opening.height} ft`, 0, 0);
          ctx.restore();
        }

        function calculateBudget(e) {
          e.preventDefault();
          const quality = document.querySelector(
            'input[name="materialQuality"]:checked'
          ).value;
          const installationLabor =
            parseFloat(document.getElementById("installationLabor").value) || 0;
          const frameLabor =
            parseFloat(document.getElementById("frameLabor").value) || 0;

          let totalMaterialCost = 0,
            totalLaborCost = 0,
            breakdown = "";

          openings.forEach((op) => {
            const area = op.width * op.height;
            const materialCost = area * costData.materialPerSqFt[quality];
            const installCost = area * installationLabor;
            const frameCost = op.frameRft * frameLabor;
            const itemTotal = materialCost + installCost + frameCost;

            totalMaterialCost += materialCost;
            totalLaborCost += installCost + frameCost;

            breakdown += `<div class="summary-item"><span>${op.name} (${
              op.width
            }'x${op.height}')</span> <span>₹${Math.round(
              itemTotal
            ).toLocaleString("en-IN")}</span></div>`;
          });

          const grandTotal = totalMaterialCost + totalLaborCost;
          lastCalculationData = {
            grandTotal,
            totalMaterialCost,
            totalLaborCost,
            openings,
            breakdown,
          };
          displayResults(lastCalculationData);
        }

        function displayResults(data) {
          document.getElementById("grandTotal").textContent = `₹${Math.round(
            data.grandTotal
          ).toLocaleString("en-IN")}`;
          document.getElementById(
            "totalMaterialCost"
          ).textContent = `₹${Math.round(data.totalMaterialCost).toLocaleString(
            "en-IN"
          )}`;
          document.getElementById(
            "totalLaborCost"
          ).textContent = `₹${Math.round(data.totalLaborCost).toLocaleString(
            "en-IN"
          )}`;
          document.getElementById("detailed-breakdown").innerHTML =
            data.breakdown;

          elements.resultsSection.classList.remove("hidden");
          window.scrollTo({
            top: elements.resultsSection.offsetTop - 20,
            behavior: "smooth",
          });
          renderChart(data.totalMaterialCost, data.totalLaborCost);
        }

        function renderChart(material, labor) {
          const ctx = document.getElementById("costChart").getContext("2d");
          if (chartInstance) chartInstance.destroy();
          chartInstance = new Chart(ctx, {
            type: "doughnut",
            data: {
              labels: ["Material Cost", "Labor Cost"],
              datasets: [
                {
                  data: [material, labor],
                  backgroundColor: ["#8b5cf6", "#10b981"],
                  borderColor: "#ffffff",
                  borderWidth: 4,
                },
              ],
            },
            options: {
              responsive: true,
              cutout: "70%",
              plugins: {
                legend: {
                  position: "bottom",
                  labels: { padding: 20, font: { size: 14 } },
                },
              },
            },
          });
        }

        function generatePDF() {
          if (!lastCalculationData) return;
          const { jsPDF } = window.jspdf;
          const doc = new jsPDF();
          const data = lastCalculationData;
          const today = new Date().toLocaleDateString("en-IN", {
            day: "2-digit",
            month: "2-digit",
            year: "numeric",
          });

          doc.setFontSize(20);
          doc.text("Doors & Windows Estimation", 105, 20, { align: "center" });
          doc.setFontSize(12);
          doc.setTextColor(100);
          doc.text(`Generated on: ${today}`, 105, 28, { align: "center" });

          let y = 45;
          doc.setFontSize(16);
          doc.setTextColor(0);
          doc.text("Cost Summary", 20, y);
          doc.line(20, y + 2, 190, y + 2);
          y += 12;

          doc.setFontSize(12);
          doc.text("Total Estimated Cost:", 20, y);
          doc.text(
            `₹${Math.round(data.grandTotal).toLocaleString("en-IN")}`,
            190,
            y,
            { align: "right" }
          );
          y += 8;
          doc.text("Total Material Cost:", 20, y);
          doc.text(
            `₹${Math.round(data.totalMaterialCost).toLocaleString("en-IN")}`,
            190,
            y,
            { align: "right" }
          );
          y += 8;
          doc.text("Total Labor Cost:", 20, y);
          doc.text(
            `₹${Math.round(data.totalLaborCost).toLocaleString("en-IN")}`,
            190,
            y,
            { align: "right" }
          );

          y += 15;
          doc.setFontSize(16);
          doc.text("Openings Breakdown", 20, y);
          doc.line(20, y + 2, 190, y + 2);
          y += 12;
          doc.setFontSize(10);
          data.openings.forEach((op) => {
            const area = op.width * op.height;
            doc.text(
              `- ${op.name}: ${op.width}' x ${op.height}' (${area.toFixed(
                2
              )} sq.ft.)`,
              20,
              y
            );
            y += 7;
          });

          doc.save(`Doors-Windows-Estimation-${Date.now()}.pdf`);
        }

        // Event Listeners
        elements.prevBtn.addEventListener("click", () => {
          if (currentStep > 1) {
            currentStep--;
            updateStepVisibility();
          }
        });
        elements.nextBtn.addEventListener("click", () => {
          if (currentStep < totalSteps) {
            currentStep++;
            updateStepVisibility();
          }
        });
        elements.form.addEventListener("submit", calculateBudget);
        elements.addOpeningBtn.addEventListener("click", addOpening);
        elements.openingsContainer.addEventListener("change", (e) => {
          if (e.target.matches(".opening-input"))
            updateOpening(
              e.target.dataset.id,
              e.target.dataset.prop,
              e.target.value
            );
        });
        elements.openingsContainer.addEventListener("click", (e) => {
          if (e.target.matches(".remove-opening-btn"))
            removeOpening(e.target.dataset.id);
        });
        elements.downloadPdfBtn.addEventListener("click", generatePDF);

        addOpening();
        updateStepVisibility();
      });
    </script>
  </body>
</html>
